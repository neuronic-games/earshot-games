<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  
  <meta http-equiv='cache-control' content='no-cache'>
  <meta http-equiv='expires' content='0'>
  <meta http-equiv='pragma' content='no-cache'>

  <!-- <meta http-equiv="EXPIRES" content="Mon, 24 April 2023 11:00:00 GMT" /> -->

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />

  <title>Earshot Games</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
  <link rel="stylesheet" href="slick/slick.css" />
  <link rel="stylesheet" href="slick/slick-theme.css" />
  <link rel="stylesheet" href="css/style.css?version=1.0.3" />
  <link rel="icon" type="image/x-icon" href="earshot-logo_icon.png" />
  <link rel="apple-touch-icon" href="earshot-logo_icon.png" />
</head>

<body class="page_greek">

  <!--- Modal View Start-->
  <div class="modal fade" id="myModal2" role="dialog">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" id="goModal2">
        <div class="playerContainer">
          <label class="playerLabel">Players</label>
          <div id="btnMinusPlayer" class="card-header ak_card_minus" style="z-index: 999999;">
            <img src="images/ear_icon_minus.png" width="90px" height="90px" alt="" onclick="onDecreasePlayers()" />
          </div>
          <label id="playerTotal" class="playerFilter">1</label>
          <div id="btnPlusPlayer" class="card-header ak_card_plus" style="z-index: 999998;">
            <img src="images/ear_icon_plus.png" width="90px" height="90px" alt="" onclick="onIncreasePlayers()" />
          </div>
          <label class="cBoxContainer">
            <input id="cBoxPlayer" type="checkbox" onclick="onPlayerCheckClick()">
            <span class="cBoxCheckmark"></span>
          </label>
        </div>
        <div class="timeContainer">
          <label class="timeLabel">Time(Mins)</label>
          <div id="btnMinusTime" class="card-header ak_card_minus">
            <img src="images/ear_icon_minus.png" width="90px" height="90px" alt="" onclick="onDecreaseTime()" />
          </div>
          <label id="timeTotal" class="timeFilter">15</label>
          <div id="btnPlusTime" class="card-header ak_card_plus">
            <img src="images/ear_icon_plus.png" width="90px" height="90px" alt="" onclick="onIncreaseTime()" />
          </div>
          <label class="cBoxContainer">
            <input id="cBoxTime" type="checkbox" onclick="onTimeCheckClick()">
            <span class="cBoxCheckmark"></span>
          </label>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal View End -->
  <!-- List / Slideshow View Start -->
  <div class="container mt-2 mb-5">
    <div class="row">
      <div class="col-md-12 list-view-section">
        <div class="row bg-alto header-row-section mx-0 d-none align-items-center" style="display: flex;">
            <div class="col p-0">
              <div class="bg-alto py-1 my-0 px-2 preview_title pointer-cursor text-left">
                <button class="btn btn-outline-primary" onClick="viewSlideShowHTML();">SLIDESHOW</button>
                <button class="btn btn-outline-primary" onClick="viewSsearchPanel();">FIND</button>
              </div>
            </div>
            <div class="col-auto-grid">
                <div class="pagination-bar d-flex justify-content-end">
                  <a id="prevLink" href="javascript:;" class="page-pre text-right text-uppercase">Prev</a>
                  <div class="pagination-pages"></div>
                  <a id="nextLink" href="javascript:;" class="page-next text-right text-uppercase">Next</a>
                </div>
            </div>
        </div>        
        <!--<div class="image_slider"> </div>-->
        <div class="cardList"></div>
      </div>
      <div class="col-md-12 list-slideshow-section d-none">
        <!-- <div class="bg-alto py-1 px-2 preview_title pointer-cursor text-right"><button class="btn btn-outline-primary" onClick="toggleSlideShowView();">View All</button></div> -->
        <div class="bg-alto py-1 px-2 preview_title pointer-cursor">
          <button class="btn btn-outline-primary" onClick="toggleSlideShowView();">VIEW ALL</button>
          <button class="btn btn-outline-primary" onClick="viewSsearchPanel();">FIND</button>
          <p id="sliderDate" class="text-right slideshowTime"></p>
        </div>
        <div class="slideshow-slider"></div>
      </div>
      <div class="col-md-12 detail-view-section d-none">
        <div class="back-btn pointer-cursor px-4 rounded-0 py-2 mb-3 btn bg-alto text-uppercase text-primary font-DINCondensed">Go Back</div>
        <div class="game-details"></div>
      </div>
      <!-- <div class="text-center loader-spinner" style="margin: auto;">
        <img src="./css/Reload-1s-200px.gif" width="50" height="50" class="image_id text-center" alt="" />
      </div> -->
      <div class="text-center loader-spinner-text" style="margin: auto;">
        <img src="earshot-logo_icon.png" width="45" height="45" class="image_id text-center" alt="" />
        <!-- <img src="./css/Reload-1s-200px.gif" width="40" height="40" class="image_id text-center" alt="" /> -->
        <p id="loadingTxt"></p>
      </div>
    </div>
  </div>
  <!-- List / Slideshow View End -->
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="slick/slick.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
    integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>

  <!-- <script src="js-package/store.legacy.min.js"></script> -->
  <script>

    // checking Listener
    //addEventListener("resize", (event) => {renderPaginationHTML()});

    //////////////////////////////////////////////////////////////////////////////////////////////////
    /* function closeIt(event)
    {
      //localStorage.setItem("refreshStatus", "true")
      return "Any string value here forces a dialog box to \n" + 
            "appear before closing the window.";
      
    }
    window.onbeforeunload = closeIt; */
    //////////////////////////////////////////////////////////////////////////////////////////////////
    // Checking whether the page is loaded or reloaded/refresh
    /* if (window.performance) {
      if (performance.navigation.type == 1) {
        alert( "This page is reloaded" );
      } else {
        alert( "This page is not reloaded");
      }
    } */
    //////////////////////////////////////////////////////////////////////////////////////////////////
    // Checkbox
    var inputs = document.getElementsByTagName('input');
    for (var i=0; i<inputs.length; i++)  {
      if (inputs[i].type == 'checkbox')   {
        inputs[i].checked = false;

        // For Player
        document.getElementById("btnMinusPlayer").style.display = "none"
        document.getElementById("btnPlusPlayer").style.display = "none"
        document.getElementById('playerTotal').innerHTML = "ANY"
        document.getElementById('playerTotal').style.color = "red"

        // For Time
        document.getElementById("btnMinusTime").style.display = "none"
        document.getElementById("btnPlusTime").style.display = "none"
        document.getElementById('timeTotal').innerHTML = "ANY"
        document.getElementById('timeTotal').style.color = "red"

      }
    }
    function onPlayerCheckClick(event) {
      //console.log("PlayeCheckBoxClick - ", document.getElementById("cBoxPlayer").checked)
      var cBoxPlayerStat = document.getElementById("cBoxPlayer").checked
      if(cBoxPlayerStat == true) {
        document.getElementById("btnMinusPlayer").style.display = "block"
        document.getElementById("btnPlusPlayer").style.display = "block"
        document.getElementById('playerTotal').innerHTML = playerCount
        document.getElementById('playerTotal').style.color = "black"
      } else {
        document.getElementById("btnMinusPlayer").style.display = "none"
        document.getElementById("btnPlusPlayer").style.display = "none"
        document.getElementById('playerTotal').innerHTML = "ANY"
        document.getElementById('playerTotal').style.color = "red"
      }
      filterGamesOnPlayerTime()
    }
    function onTimeCheckClick(event) {
      //console.log("PlayeCheckBoxClick - ", document.getElementById("cBoxPlayer").checked)
      var cBoxTimeStat = document.getElementById("cBoxTime").checked
      if(cBoxTimeStat == true) {
        document.getElementById("btnMinusTime").style.display = "block"
        document.getElementById("btnPlusTime").style.display = "block"
        document.getElementById('timeTotal').innerHTML = timeCount
        document.getElementById('timeTotal').style.color = "black"
      } else {
        document.getElementById("btnMinusTime").style.display = "none"
        document.getElementById("btnPlusTime").style.display = "none"
        document.getElementById('timeTotal').innerHTML = "ANY"
        document.getElementById('timeTotal').style.color = "red"
      }
      filterGamesOnPlayerTime()
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    //localStorage.setItem("refreshStatus", "null")
    // Global Variables
    var allBoardGames = [];
    var boardgames;
    var boardgameBasicData;
    var paged = 0;
    var sourceType = '';
    var MODE_TYPE = 'list';
    var RATING_MODE = "star"
    var loadType = ""

    var settingLoaded = false
    var privateLoaded = false
    var gameLoaded = false

    //////////////////////////////////////////////////////////////////////////////////////////////////
    // Checking whether the page is loaded or reloaded/refresh
    if (window.performance) {
      if (performance.navigation.type == 1) {
        //alert( "This page is reloaded" );
        loadType = "refresh"
      } else {
        //alert( "This page is not reloaded");
        loadType = "normal"
      }
    }
    //console.log(loadType, " LoadType")
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function updateSlideshowTimer() {
      const sliderTimerEvent = setTimeout(function() {
        clearTimeout(sliderTimerEvent)
        var nDate = moment(new Date()).format("hh:mm A")
        document.getElementById('sliderDate').innerHTML = nDate;
      }, 1000)
      updateSlideshowTimer()
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    // IDLE TIMEOUT
    let idleTimeOut = 60 // Idle threshold 1 MINS
    var idleState = false;
	  var idleTimer = null;

    // For Filter variables
    var playerCount = 1
    var timeCount = 15
    $('*').bind('mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick', function () {
        clearTimeout(idleTimer);
        ////////////////////////////////////////////////////////////////////
        if (idleState == true) { 
          // console.log("Active");
          // toggleSlideShowView();
        }
        ////////////////////////////////////////////////////////////////////
        idleState = false;
        idleTimer = setTimeout(function () { 
          // console.log("In-Active");
          if(typeof boardgames == 'undefined' || boardgames == ''){
            return false;
          }
          ////////////////////////////////////////////////////////////////////
          if(MODE_TYPE == 'list') {
            viewSlideShowHTML();
          }
          ////////////////////////////////////////////////////////////////////
          idleState = true; 
        }, idleTimeOut * 1000);
    });

    //////////////////////////////////////////////////////////////////////////////////////////////////
    function getUrlVars() {
      var vars = [], hash;
      var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
      for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
      }
      return vars;
    }  
    //////////////////////////////////////////////////////////////////////////////////////////////////
    // TO LOAD PRIVATE DATA IN THE BEGINNING
    let privateDataList = []
    let sheet_Name = ''
    let user_name = ''

    //console.log(store.get('earshot_bgg_game'), " boardgame data")

    function getGamesPrivateData() {

      // showing message
      document.getElementById("loadingTxt").innerHTML = "Loading... <br> Games private data"

      if(loadType == "normal" && localStorage.getItem("earshot_privateData") != null) {
      /* if(loadType == "normal" && store.get('earshot_privateData') != "undefined") { */
      /* if(loadType == "normal" && store.get('earshot_bggData') != "undefined") { */

        //console.log("Loading from localstorage - privateDataList")
        // Reassign the stored value
       
         privateDataList = JSON.parse(localStorage.getItem("earshot_privateData"))
       /* privateDataList = JSON.parse(store.get('earshot_privateData').data) */
      /*  privateDataList = JSON.parse(store.get('earshot_bggData').bgg_privateData) */
       
       // Check for username passed from querystring else set the username from sheet data
       privateLoaded = true
        checkUserQueryString()

      } else /* if(loadType == "refresh")  */{
        //console.log("Loading from server - privateDataList")
        $.ajax({ 
          //url: apiurl, 
          url: 'private_data.php', 
          type:'POST', 
          data:{'sheetId' : sheet_Id, 'sheet' : sheet_Name}, 
          cache: false, 
          success: function (response) {
            //console.log(response)
            var mResponseSC = response.replace(/�/g, "") 
            var mResponseDQ = mResponseSC.replace(/"/g, "dqo") 
            var mResponseDDQ = mResponseDQ.replace(/: dqo/g, ": 'dqo") 
            var mResponseDDQE = mResponseDDQ.replace(/dqo,/g, "dqo',") 
            const regex = /('(?=(,\s*')))|('(?=:))|((?=([:,]\s*))')|((?={)')|('(?=}))/g; 
            let replaceResponseRegX = mResponseDDQE.replace(regex, '"').replace(/{'/g, '{"').replace(/: '/g, ': "').replace(/, '/g, ', "'); 
            let replaceResponse = replaceResponseRegX.replace(/\\'/g, "'"); 
            privateDataList = JSON.parse(replaceResponse)

            // Storing to local storage
            localStorage.setItem("earshot_privateData", JSON.stringify(privateDataList)) 
            /* store.set("earshot_privateData", { data:JSON.stringify(privateDataList)}) */
            /* store.set("earshot_bggData", { bgg_privateData:JSON.stringify(privateDataList)}) */
            
            //console.log(privateDataList, " DATA")
            // Check for username passed from querystring else set the username from sheet data
            privateLoaded = true
            checkUserQueryString()
          }
        })
      }
      
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    // Load Setting
    let settingDataList = []
    function getGamesSettingData() {

      // showing message
      document.getElementById("loadingTxt").innerHTML = "Loading... <br> Games setting data"

      if(loadType == "normal" && localStorage.getItem("earshot_settingData") != null) {
      /* if(loadType == "normal" && store.get('earshot_settingData') != "undefined") { */
        
      /* if(loadType == "normal" && store.get('earshot_bggData').bgg_settingData != "undefined") { */

        //console.log("Loading from localstorage - settingDataList")
        
        // Reassign the stored value
        settingDataList = JSON.parse(localStorage.getItem("earshot_settingData"))
        /* settingDataList = JSON.parse(store.get('earshot_settingData').data) */
        /* settingDataList = JSON.parse(store.get('earshot_bggData').bgg_settingData) */

        settingLoaded = true

        // Getting game private data based on the filter
        $.each(settingDataList, function (index, row) {
          if(row["Profile"] == "BGG") {
            sheet_Name = row["Sheet"]
            user_name = row["User"]
            // Load list at start
            getGamesPrivateData()
          }
        })

      } else /* if(loadType == "refresh") */ {
        //console.log("Loading from server - settingDataList")
        $.ajax({ 
          //url: apiurl, 
          url: 'private_data.php', 
          type:'POST', 
          data:{'sheetId' : sheet_Id, 'sheet' : 'Settings'}, 
          cache: false, 
          success: function (response) {
            //console.log(response)
            var mResponseSC = response.replace(/�/g, "") 
            var mResponseDQ = mResponseSC.replace(/"/g, "dqo") 
            var mResponseDDQ = mResponseDQ.replace(/: dqo/g, ": 'dqo") 
            var mResponseDDQE = mResponseDDQ.replace(/dqo,/g, "dqo',") 
            const regex = /('(?=(,\s*')))|('(?=:))|((?=([:,]\s*))')|((?={)')|('(?=}))/g; 
            let replaceResponseRegX = mResponseDDQE.replace(regex, '"').replace(/{'/g, '{"').replace(/: '/g, ': "').replace(/, '/g, ', "'); 
            let replaceResponse = replaceResponseRegX.replace(/\\'/g, "'"); 
            settingDataList = JSON.parse(replaceResponse)  
            //console.log(settingDataList, " Setting DATA")

            // Storing to local storage
            localStorage.setItem("earshot_settingData", JSON.stringify(settingDataList)) 
            /* store.set("earshot_settingData", { data:JSON.stringify(settingDataList)}) */
           /*  store.set("earshot_bggData", { bgg_settingData:JSON.stringify(settingDataList)}) */

           settingLoaded = true

            $.each(settingDataList, function (index, row) {
              if(row["Profile"] == "BGG") {
                sheet_Name = row["Sheet"]
                user_name = row["User"]
                // Load list at start
                getGamesPrivateData()
              }
            })
            
          }
        })
      }

    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    var sheet_Id = (getUrlVars()["id"]) ? getUrlVars()["id"] : '';
    if(sheet_Id == '') {
        //$(".cardList").html('<div class="text-center mt-5 pt-5"><h3>Sheet ID MISSING</h3><p>Use correct setting seet Id.</p></div>');
          //hideloader();
          checkUserQueryString()
    } else {
      // Load setting data at start
      // Shiowing Loading modal
      getGamesSettingData()
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function checkUserQueryString() {
      // showing message
      document.getElementById("loadingTxt").innerHTML = "Loading... <br> Games data"

      var username = (getUrlVars()["username"]) ? getUrlVars()["username"] : user_name;
      if(username == ''){
        $(".cardList").html('<div class="bg-alto header-row-section p-3"></div><div class="text-center mt-4 pt-4"><h1 class="text-center">SHEET ID OR USERNAME IS MISSING</h1><div class="text-center">Use correct sheet id or username to find its game collection.</div></div>')
        hideloader();
      } else {
        //console.log(localStorage.getItem("earshot_boardgames"), " --- ", loadType)
        if(loadType == "normal" && localStorage.getItem("earshot_boardgames") != null) {
        /* if(loadType == "normal" && store.get('earshot_boardgames') != "undefined") { */
        /* if(loadType == "normal" && store.get('earshot_bggData').bgg_boardGames != "undefined") { */

          // Load data
          //console.log("Loading data from local storage - checkUserQueryString")
          
          boardgames = shuffleArray(JSON.parse(localStorage.getItem("earshot_boardgames")));
          /* boardgames = shuffleArray(JSON.parse(store.get('earshot_boardgames').data)); */
          /* boardgames = shuffleArray(JSON.parse(store.get('earshot_bggData').bgg_boardGames)); */
          
          // Soted the game data initially for filtering
          allBoardGames = []
          
          allBoardGames.push(JSON.parse(localStorage.getItem("earshot_boardgames")))
          /* allBoardGames.push(JSON.parse(store.get('earshot_boardgames').data)) */
          /* allBoardGames.push(JSON.parse(store.get('earshot_bggData').bgg_boardGames)) */
          // console.log(boardgames);
          
          boardgameBasicData = JSON.parse(localStorage.getItem("earshot_boardgameBasicData"));
          /* boardgameBasicData = JSON.parse(store.get('earshot_boardgameBasicData').data); */
          /* boardgameBasicData = JSON.parse(store.get('earshot_bggData').bgg_boardgameBasicData); */

          gameLoaded = true
          
          //////////////////////////////////////////////////////
          // Batch Update Games to google sheet
          batchUpdateGameList(boardgames)
          //////////////////////////////////////////////////////
          // render pagination
          renderPaginationHTML();
          let boardgamesChunks = boardgames.slice(0, 10);
          $.each(boardgamesChunks, function (index, data) {
            renderListViewItem(data);
          });
          hideloader();
        } else /* if(loadType == "refresh") */ {
          //console.log("Loading data from server - checkUserQueryString- ", username)
          $.ajax({
            //url: apiurl, 
            url: 'data.php',
            type: 'POST',
            data: 'username=' + username,
            cache: false,
            dataType: 'JSON',
            success: function (response) {
              if (response.status == 200) {
                boardgames = shuffleArray(response.boardgame);

                localStorage.setItem("earshot_boardgames", JSON.stringify(response.boardgame))
                /* store.set("earshot_boardgames", { data:JSON.stringify(response.boardgame)}) */
                /* store.set("earshot_bggData", { bgg_boardGames:JSON.stringify(response.boardgame)}) */

                // Soted the game data initially for filtering
                allBoardGames = []
                allBoardGames.push(response.boardgame)
                // console.log(boardgames);
                boardgameBasicData = response.boardgameBasicData;

                localStorage.setItem("earshot_boardgameBasicData", JSON.stringify(response.boardgameBasicData))
                /* store.set("earshot_boardgameBasicData", { data:JSON.stringify(response.boardgameBasicData)}) */
                /* store.set("earshot_bggData", { bgg_boardgameBasicData:JSON.stringify(response.boardgameBasicData)}) */

                gameLoaded = true
                
                //////////////////////////////////////////////////////
                // Batch Update Games to google sheet
                batchUpdateGameList(boardgames)
                //////////////////////////////////////////////////////
                // render pagination
                renderPaginationHTML();
                let boardgamesChunks = boardgames.slice(0, 10);
                $.each(boardgamesChunks, function (index, data) {
                  renderListViewItem(data);
                });
                // initiateSlickSlider();
              } else {
                // alert(response.error);
                // $(".cardList").html('<div class="alert alert-danger">'+response.error+'</div>');
                $(".cardList").html('<div class="text-center mt-5 pt-5"><h3>NO COLLECTION FOR THIS USER</h3><p>Use correct user to find its game collection.</p></div>');
              }
              hideloader();
            },
          });
        }
      }
    }
    ///////////////////////////////////////////////////////////////////////////////////////////////////
    function removeItemOnce(arr, value) {
      for(var i=0; i < privateDataList.length; i++) {
        var gameDetails = []
        gameDetails.push([String(privateDataList[i]["Game ID"]), String(privateDataList[i]["Game Name"])])
        for (var j=0; j < arr.length; j++) {
          //console.log(arr[j][0], " === ", gameDetails[0][0])
          if(arr[j][0] == gameDetails[0][0]) {
            arr.splice(j, 1);
          }
        }
      }
      return arr;
    }
    function batchUpdateGameList(data) {
      var gameObj = []
      for (var i=0; i < data.length; i++) {
        var eachGame = []
        var objectid = data[i]['@attributes']['objectid'];
        var gameTitle = boardgameBasicData[objectid]['name']
        eachGame.push(String(objectid), String(gameTitle).replace(/[\u{0080}-\u{10FFFF}]/gu,""))
        gameObj.push(eachGame)
      }
      if(privateDataList.length < gameObj.length) {
        //console.log(removeItemOnce(gameObj, privateDataList))
        var updateSheetList = removeItemOnce(gameObj, privateDataList)
        var dataList = JSON.stringify(updateSheetList);
        // Call PHP/PYTHON
        $.ajax({ 
          //url: apiurl, 
          url: 'insert_data.php', 
          type:'POST', 
          data:{'sheetId' : sheet_Id, 'sheet' : sheet_Name, 'gamesData' : dataList}, 
          cache: false, 
          success: function (response) {
            console.log(response)
          }
        })
      } {
        console.log("Sheet already updated...")
      }
    }
     //////////////////////////////////////////////////////////////////////////////////////////////////
    function hideloader() {
      /* $('.loader-spinner').addClass('d-none'); */
      $('.loader-spinner-text').addClass('d-none');
    }
     //////////////////////////////////////////////////////////////////////////////////////////////////
    function showloader() {
      /* $('.loader-spinner').removeClass('d-none'); */
      $('.loader-spinner-text').removeClass('d-none');
    }
     //////////////////////////////////////////////////////////////////////////////////////////////////
    function renderPaginationHTML() {
      
      const detectDeviceType = () =>
      /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
        ? 'Mobile'
        : 'Desktop';
      //console.log(detectDeviceType()); 
      var deviceType = detectDeviceType()


      let per_page_items = 10;
      let totalPages = Math.floor( (boardgames.length / per_page_items));
      let extraPosts = (boardgames.length % per_page_items);
      totalPages = (extraPosts > 0 ) ? totalPages + 1 : totalPages;
      var paginationHTML = '';
      var startIndex = 0;
      var endIndex = totalPages > 5 ? 5 : totalPages;
      var currentPageNumber = (paged + 1);
      
      //console.log("currentPageNumber ", currentPageNumber);

  
      
      if(totalPages > 5) {
        if(currentPageNumber >= (totalPages-3)){
          var startIndex = totalPages-5;
          var endIndex = totalPages;
        } else if (currentPageNumber > 2) {
          startIndex = (currentPageNumber - 3);
          endIndex = (currentPageNumber + 2);
        }
      } else {
        endIndex = totalPages
      }

      // console.log("startIndex ", startIndex);
      // console.log("endIndex ", endIndex);

      for (loop = startIndex; loop < endIndex; loop++) {
        let active = (loop == paged) ? 'active' : '';
        if (paginationHTML == "") { paginationHTML = ' <span class="line"></span> '; }
        paginationHTML += "<a href='javascript:;' class='page-number " + active + "' data-paged='" + loop + "'> " + (loop + 1) + " </a> <span class='line'></span> ";
      }
      if(paged == (totalPages-1) ){
        $(".page-next").addClass('disabled-link');
      }else{
        $(".page-next").removeClass('disabled-link');
      }
      if(paged == 0 ){
        $(".page-pre").addClass('disabled-link');
      }else{
        $(".page-pre").removeClass('disabled-link');
      }
      if(deviceType == "Desktop") {
        $('.pagination-pages').html(paginationHTML);
      } else {
        $('.pagination-pages').html(' <span class="line"></span> ');
      }
      $('.header-row-section').removeClass('d-none');
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function renderRealetedBoardGameSlider() {
      $('.related_games').html();
      var suggestedGamesHTML = '';
      var startIndex = Math.floor(Math.random() * boardgames.length);
      if(startIndex > (boardgames.length-10) ){ startIndex = boardgames.length-10; }
      // console.log(startIndex, boardgames);
      for (var loop = 0; loop < 10; loop++) {
        if (boardgames[startIndex]) {
          data = boardgames[startIndex];
          var objectid = data['@attributes']['objectid'];
          suggestedGamesHTML += `<div class="slider_item"><div class="image-outer"><a href="javascript:;" class="view-details" data-objectid="${objectid}"><img src="${data.image}" class="img-fluid" id="sliderImg"></a></div><a href="javascript:;" class="text-primary text-uppercase font-DINCondensed text-truncate m-0 p-2 text-center overflow-hidden text-nowrap slide_item_title view-details" data-objectid="${objectid}">${getBoardGameName(data)}</a></div>`;
          startIndex += 1;
        }
      }
      $('.related_games').html(suggestedGamesHTML);
      initiateRelatedGamesSlider();
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function viewSsearchPanel() {
      //$("#searchPanel").slideToggle("fast");
      $('#myModal2').modal('show');

      // Set the default values
      var cBoxPlayerStat = document.getElementById("cBoxPlayer").checked;
      if(cBoxPlayerStat == true) {
        document.getElementById('playerTotal').innerHTML = playerCount
      } else {
        document.getElementById('playerTotal').innerHTML = "ANY"
      }

      var cBoxTimeStat = document.getElementById("cBoxTime").checked;
      if(cBoxTimeStat == true) {
        document.getElementById("timeTotal").innerHTML = timeCount
      } else {
        document.getElementById("timeTotal").innerHTML = "ANY"
      }
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function onIncreasePlayers() {
      playerCount++
      // Set the default values
      document.getElementById('playerTotal').innerHTML = playerCount
      filterGamesOnPlayerTime()
    }
    function onDecreasePlayers() {
      if(playerCount > 1) {
        playerCount--
      }
      // Set the default values
      document.getElementById('playerTotal').innerHTML = playerCount
      filterGamesOnPlayerTime()
    }
    // Time
    function onIncreaseTime() {
      timeCount += 15
      // Set the default values
      document.getElementById("timeTotal").innerHTML = timeCount
      filterGamesOnPlayerTime()
    }
    function onDecreaseTime() {
      if(timeCount > 15) {
        timeCount -= 15
      }
      // Set the default values
      document.getElementById("timeTotal").innerHTML = timeCount
      filterGamesOnPlayerTime()
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function filterGamesOnPlayerTime() {
      //console.log(playerCount, " ---- ", timeCount)
      $(".cardList").html("")
      //setTimeout(function() {
      RenderListView()
      RenderSlideshowView()
      //}, 250)
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function RenderSlideshowView() {
      if($('.slideshow-slider').html() != ''){
        $('.slideshow-slider').slick('unslick').html('');
      }
      //////////////////////////////////////////////////////////////////////////////
      
      // Show games only whose showcase is true in spreadsheet
      // Filter the games
      var filterGames = []
      $.each(boardgames, function(index, data) {
      //$.each(allBoardGames[0], function(index, data) {
        var objectid = data['@attributes']['objectid'];
        $.each(privateDataList, function (index, row) {
          if (row["Game ID"] == objectid && row["Showcase"] == "TRUE") {
            filterGames.push(data)
          }
        });
      });
      //////////////////////////////////////////////////////////////////////////////
      if(filterGames.length > 0) {
        //$.each(boardgames, function(index, data) {
        $.each(filterGames, function(index, data) {
          var objectid = data['@attributes']['objectid'];
          var description = data.description;
          if (description.length > 260) {
            textContent = description.substr(0,250) + '...';
          }
          var gameRatingAverage = getBoardGameRatingAverage(data);
          var ratingInPercentage = ((gameRatingAverage - 5)*5/2) * 14;
          if(ratingInPercentage < 0) {
            ratingInPercentage = 0
          } else if(ratingInPercentage > 100) {
            ratingInPercentage = 100
          }
          /////////////////////////////////////////////////////////////////////////////////////
          var playerStats = (data.minplayers == data.maxplayers) ? data.maxplayers : data.minplayers+"-"+data.maxplayers;
          var playtimeStats = (data.minplaytime == data.maxplaytime) ? data.maxplaytime : data.minplaytime+"-"+data.maxplaytime;
          $('.slideshow-slider').append(`<div class="slider_item"><div class="slider_item_wrapper"><div class="image-outer"><a href="javascript:;" class="games-slider-item view-details" data-sourceType="slideshow" data-objectid="${objectid}"><img src="${data.image}" class="img-fluid" id="sliderImg" data-BoardgamesId="${objectid}"></a></div><div class="slideshow_item_content"><h4>${getBoardGameName(data)}</h4><a href="javascript:;" class="view-details" data-objectid="${objectid}" data-sourceType="slideshow">${getBoardGameDesigner(data)}</a>
          <p>${description}</p>
        </div>
          <!--div class="d-flex justify-space-between slideshow_bottom"-->
          <div class="d-flex justify-content-between slideshow_bottom">
            <div class="bottom_left_side">
              <div class="text-right" data-objectid="${objectid}"><div class="metaGroup"><span><img src="./images/earshot-games_player.png" width="35px">${playerStats}</span><span><img src="./images/earshot-games_time.png"width="35px">${playtimeStats}</span><span><img src="./images/earshot-games_age.png"  width="35px">${data.age}+</span></div></div> 
              <!--div class="ratingWrapper"-->
              <div id="${objectid}_slide" class="ratingWrapper" onClick='toggleRating(event, ${ratingInPercentage}, ${gameRatingAverage})'>
                <div id='star_slide' class="ratingStar" style="width: ${ratingInPercentage}%"><span>&#x2605;&#x2605;&#x2605;&#x2605;&#x2605;</span></div> 
                </div>          
            </div>  
            <div class="barcode">	
              <div class="qrcode" id="slide_${objectid}_barcode"></div>
            </div>      
          </div>
          </div>

          </div>
          `);
          renderQRCode(`slide_${objectid}_barcode`, objectid);
        });
      } else {
        $(".slideshow-slider").html('<div class="text-center mt-4 pt-4"><h1 class="text-center">NO GAME FOUND BASED ON FILTER CRITERIA.</h1></div>')
      }
      ////////////////////////////////////////////
      initiateSlideShowSlider();
      ////////////////////////////////////////////
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function RenderListView() {
      //boardgames = shuffleArray(boardgames);
      //console.log(boardgames);
      //boardgameBasicData = boardgames.boardgameBasicData;
      //////////////////////////////////////////////////////
      var filterBoardGames = []
      //console.log(allBoardGames[0], " all games ")
      $.each(allBoardGames[0], function(index, data) {
        var objectid = data['@attributes']['objectid'];
        var playerStats = (data.minplayers == data.maxplayers) ? data.maxplayers : data.minplayers
        var playerMin = data.minplayers
        var playerMax = data.maxplayers
        var playtimeStats = (data.minplaytime == data.maxplaytime) ? data.maxplaytime : data.minplaytime
        var timeMin = data.minplaytime
        var timeMax = data.maxplaytime
        //console.log(playerCount, " <= ", playerMin, " && ", playerMax)

        // Filter modified based on the items active
        var cBoxPlayerStat = document.getElementById("cBoxPlayer").checked
        var cBoxTimeStat = document.getElementById("cBoxTime").checked
        if(cBoxPlayerStat == true && cBoxTimeStat == true) {
          if(playerCount <= playerMax && timeCount <= timeMax) {
            filterBoardGames.push(data)
          }
        } else if(cBoxPlayerStat == true && cBoxTimeStat == false) {
          if(playerCount <= playerMax) {
            filterBoardGames.push(data)
          }
        } else if(cBoxPlayerStat == false && cBoxTimeStat == true) {
          if(timeCount <= timeMax) {
            filterBoardGames.push(data)
          }
        } else if(cBoxPlayerStat == false && cBoxTimeStat == false) {
          filterBoardGames.push(data)
        }
      });

      //////////////////////////////////////////////////////
      if(filterBoardGames.length > 0) {
        // render pagination
        boardgames = filterBoardGames
        //console.log(filterBoardGames.length, " ---- ", boardgames.length)
        //boardgames = shuffleArray(boardgames);
        //boardgameBasicData = boardgames.boardgameBasicData;
        //console.log(boardgames.length)
        paged = 0

        /* document.getElementById("prevLink").innerHTML = "Prev &nbsp;"
        document.getElementById("nextLink").innerHTML = "&nbsp; NEXT" */
        document.getElementById("prevLink").innerHTML = "Prev"
        document.getElementById("nextLink").innerHTML = "NEXT"

        renderPaginationHTML();
        let boardgamesChunks = boardgames.slice(0, 10);
        $.each(boardgamesChunks, function (index, data) {
          renderListViewItem(data);
        });
        //boardgames.splice(0)
      } else {
        if(boardgames.length == 0) {
          paged = -1
        }
        document.getElementById("prevLink").innerHTML = ""
        document.getElementById("nextLink").innerHTML = ""
        $('.pagination-pages').html("");
        $(".cardList").html('<div class="text-center mt-4 pt-4"><h1 class="text-center">NO GAME FOUND BASED ON FILTER CRITERIA.</h1></div>')
      }
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function viewSlideShowHTML() {
      // Hide the Filter modal if open
      $('#myModal2').modal('hide');

      MODE_TYPE = 'slideshow'

      if($('.slideshow-slider').html() != ''){
        $('.slideshow-slider').slick('unslick').html('');
      }

      //////////////////////////////////////////////////////////////////////////////
      // Show games only whose showcase is true in spreadsheet
      // Filter the games
      var filterGames = []
      $.each(boardgames, function(index, data) {
      //$.each(allBoardGames[0], function(index, data) {
        var objectid = data['@attributes']['objectid'];
        $.each(privateDataList, function (index, row) {
          if (row["Game ID"] == objectid && row["Showcase"] == "TRUE") {
            filterGames.push(data)
          }
        });
      });
      //////////////////////////////////////////////////////////////////////////////
      if(filterGames.length > 0) {
        //$.each(boardgames, function(index, data) {
        $.each(filterGames, function(index, data) {
          var objectid = data['@attributes']['objectid'];

          var description = data.description;
          if (description.length > 260) {
            textContent = description.substr(0,250) + '...';
          }
          var gameRatingAverage = getBoardGameRatingAverage(data);

          //var ratingInPercentage = ((gameRatingAverage*100)/5);

          /////////////////////////////////////////////////////////////////////////////////////

          //var ratingInPercentage = ((gameRatingAverage - 6)*5/2) * 20;
          var ratingInPercentage = ((gameRatingAverage - 5)*5/2) * 14;

          if(ratingInPercentage < 0) {
            ratingInPercentage = 0
          } else if(ratingInPercentage > 100) {
            ratingInPercentage = 100
          }

          /////////////////////////////////////////////////////////////////////////////////////
          //var nDate = moment(new Date()).format("hh:mm A")
          //document.getElementById('sliderDate').innerHTML = nDate;
            let mTimerTimeout = setTimeout(updateTimerTimer, 10)
            function updateTimerTimer() {
              clearTimeout(mTimerTimeout)
              document.getElementById("sliderDate").innerHTML = moment(new Date()).format("hh:mm A")
              mTimerTimeout = setTimeout(updateTimerTimer, (1000))
            }
          /////////////////////////////////////////////////////////////////////////////////////

          var playerStats = (data.minplayers == data.maxplayers) ? data.maxplayers : data.minplayers+"-"+data.maxplayers;
          var playtimeStats = (data.minplaytime == data.maxplaytime) ? data.maxplaytime : data.minplaytime+"-"+data.maxplaytime;

          $('.slideshow-slider').append(`<div class="slider_item"><div class="slider_item_wrapper"><div class="image-outer"><a href="javascript:;" class="games-slider-item view-details" data-sourceType="slideshow" data-objectid="${objectid}"><img src="${data.image}" class="img-fluid" id="sliderImg" data-BoardgamesId="${objectid}"></a></div><div class="slideshow_item_content"><h4>${getBoardGameName(data)}</h4><a href="javascript:;" class="view-details" data-objectid="${objectid}" data-sourceType="slideshow">${getBoardGameDesigner(data)}</a>
          <p>${description}</p>
        </div>
          <!--div class="d-flex justify-space-between slideshow_bottom"-->
          <div class="d-flex justify-content-between slideshow_bottom">
            <div class="bottom_left_side">
              <div class="text-right" data-objectid="${objectid}"><div class="metaGroup"><span><img src="./images/earshot-games_player.png" width="35px">${playerStats}</span><span><img src="./images/earshot-games_time.png"width="35px">${playtimeStats}</span><span><img src="./images/earshot-games_age.png"  width="35px">${data.age}+</span></div></div> 
              <!--div class="ratingWrapper"-->
              <div id="${objectid}_slide" class="ratingWrapper" onClick='toggleRating(event, ${ratingInPercentage}, ${gameRatingAverage})'>
                <div id='star_slide' class="ratingStar" style="width: ${ratingInPercentage}%"><span>&#x2605;&#x2605;&#x2605;&#x2605;&#x2605;</span></div> 
                </div>          
            </div>  
            <div class="barcode">	
              <div class="qrcode" id="slide_${objectid}_barcode"></div>
            </div>      
          </div>
          </div>

          </div>
          `);

          renderQRCode(`slide_${objectid}_barcode`, objectid);
        });
      } else {
        $(".slideshow-slider").html('<div class="text-center mt-4 pt-4"><h1 class="text-center">NO GAME FOUND BASED ON FILTER CRITERIA.</h1></div>')
      }

      // Manual SlideShow View
      $("body").addClass("AnimateView");
      $(".list-slideshow-section").removeClass("d-none");
      $(".list-view-section").addClass("d-none");
      $(".detail-view-section").addClass("d-none");

      ////////////////////////////////////////////
      initiateSlideShowSlider();
      ////////////////////////////////////////////

      // Automatic Slideshow View
      // toggleSlideShowView();
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function toggleSlideShowView() {
      MODE_TYPE = 'list'

      if($(".list-slideshow-section").hasClass("d-none")){
        $("body").addClass("AnimateView");
        $(".list-slideshow-section").removeClass("d-none");
        $(".list-view-section").addClass("d-none");
        $(".detail-view-section").addClass("d-none");
      }else{
        $(".list-slideshow-section").addClass("d-none");
        $(".detail-view-section").addClass("d-none");
        if (paged) {
          resetListPageContent(paged);
        }
        $(".list-view-section").removeClass("d-none");
        $("body").removeClass('AnimateView');
      }
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function renderListViewItem(data) {

      if(settingLoaded == false || privateLoaded == false || gameLoaded == false) {return}

      //console.log(data, " data")
      var objectid = data['@attributes']['objectid'];
      var boardgameDesc = data.description;
      if (boardgameDesc.length > 700) {
        textContent = boardgameDesc.substr(0, 690) + '...';
        // boardgamesContent = textContent.replace(/^\s+|\s+$/gm,'');
      } else {
        textContent = boardgameDesc;
      }
      // addSliderSlide(data);
      var boardGameDesigner = getBoardGameDesigner(data);
      var boardGameName = getBoardGameName(data);
      var gameRatingAverage = getBoardGameRatingAverage(data);


      ////////////////////////////////////////////////////////////////////////////////////
      //console.log(gameRatingAverage, " >>> game rating average")
      //var ratingInPercentage = ((gameRatingAverage*100)/5);

      /* var ratingInPercentage = (((Math.floor(gameRatingAverage) - 6) * 5/2) * 10) + (((Math.floor(gameRatingAverage) - 6) * 5/2) * 10)
      if(ratingInPercentage > 100) {
        ratingInPercentage = 100
      } */
      /* var ratingInPercentage = 0
      if(gameRatingAverage <= 6) {
        ratingInPercentage = 0
      } else {
        ratingInPercentage = 100
      } */
      ////////////////////////////////////////////////////////////////////////////////////
      // New Rating System
      //var ratingInPercentage = ((gameRatingAverage - 6)*5/2) * 20;
      var ratingInPercentage = ((gameRatingAverage - 5)*5/2) * 14;

      if(ratingInPercentage < 0) {
        ratingInPercentage = 0
      } else if(ratingInPercentage > 100) {
        ratingInPercentage = 100
      }

      ////////////////////////////////////////////////////////////////////////////////////

      var playerStats = (data.minplayers == data.maxplayers) ? data.maxplayers : data.minplayers+"-"+data.maxplayers;
      var playtimeStats = (data.minplaytime == data.maxplaytime) ? data.maxplaytime : data.minplaytime+"-"+data.maxplaytime; 
      //  console.log("ratingInPercentage ", ratingInPercentage);
      $(".cardList").append(`
          <div class="mt-3">
            <div class="card game-card border-0 bg-light" id="list-game-${objectid}">
              <div class="card-header border-0 bg-transparent">
                <div class="row">
                  <div class="col-md-7">
                    <h2 class="view-details game-title pointer-cursor display-5 font-DINCondensed text-primary" data-objectid="${objectid}" data-sourceType="list">${boardGameName} <sup class="text-black font-DINCondensed sup-small">${data.yearpublished}</sup></h2>
                    <h5 class="font-DINCondensed mb-0 game-designer">${boardGameDesigner}</h5>
                  </div>
                  <div class="col-md-5 text-md-right">
                    <div class="text-right" data-objectid="${objectid}"><div class="metaGroup"><span><img src="./images/earshot-games_player.png" width="35px">${playerStats}</span><span><img src="./images/earshot-games_time.png"width="35px">${playtimeStats}</span><span><img src="./images/earshot-games_age.png"  width="35px">${data.age}+</span></div></div>  
                    <div id="${objectid}" class="ratingWrapper" onClick='toggleRating(event, ${ratingInPercentage}, ${gameRatingAverage})'>
                     
                      <div id="star" class="ratingStar" style="width: ${ratingInPercentage}%"> 
                        <span>&#x2605;&#x2605;&#x2605;&#x2605;&#x2605;</span>
                      </div> 
                      
                    </div>
                  </div>
                </div>                
            </div>
            <div class="card-body">
            <div class="row">
              <div class="col-lg-3">
                <div class="img-box">
                  <img src="${data.image}" class="img-fluid view-details pointer-cursor" data-objectid="${objectid}" data-sourceType="list" >
                </div>  
                <div class="view-details d-none d-md-block" data-objectid="${objectid}" data-sourceType="list"><h5 class="pointer-cursor text-danger m-0 font-DINCondensed text-uppercase">More</h5></div>
              </div>
               <div class="col-lg-9">  
                <div class="font-DINCondensed text-large">${textContent}</div>
               </div>
                <div class="col-12 d-block d-md-none">                
                  <div class="view-details" data-objectid="${objectid}" data-sourceType="list"><h5 class="pointer-cursor text-danger m-0 font-DINCondensed text-uppercase">More</h5></div>
                </div>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>`);
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function toggleRating(event, _percentage, _bggRating) {
      //console.log(event.target.parentElement.parentElement.id)
      var elm = document.getElementById(event.target.parentElement.parentElement.id)
      //console.log(elm.innerHTML.split('id=')[1].split(" ")[0], " Selected ID ", elm)
      /* var elm = document.getElementById("sss")*/
      RATING_MODE = elm.innerHTML.split('id=')[1].split(" ")[0]
      if(RATING_MODE == null) {return}
      elm.innerHTML = ""
      if(RATING_MODE == '"star"' || RATING_MODE == '"star_d"' || RATING_MODE == '"star_slide"') {
        //RATING_MODE = 'bgg'
        //console.log(elm.innerHTML)
        if(RATING_MODE == '"star"') {
          nDiv = `<div id="bgg" class="ratingStar" style="width:100%"><p>BGG Rating : ${_bggRating.toFixed(2)}</p></div>`
        } else if(RATING_MODE == '"star_d"') {
          nDiv = `<div id="bgg_d" class="ratingStar" style="width:100%"><p>BGG Rating : ${_bggRating.toFixed(2)}</p></div>`
        } else {
          nDiv = `<div id="bgg_slide" class="ratingStar" style="width:100%"><p>BGG Rating : ${_bggRating.toFixed(2)}</p></div>`
        }
      } else {
        //RATING_MODE = 'star'
        if(RATING_MODE == '"bgg"') {
          nDiv = `<div id="star" class="ratingStar" style="width: ${_percentage}%"><span>&#x2605;&#x2605;&#x2605;&#x2605;&#x2605;</span></div>`
        } else if(RATING_MODE == '"bgg_d"') {
          nDiv = `<div id="star_d" class="ratingStar" style="width: ${_percentage}%"><span>&#x2605;&#x2605;&#x2605;&#x2605;&#x2605;</span></div>`
        } else {
          nDiv = `<div id="star_slide" class="ratingStar" style="width: ${_percentage}%"><span>&#x2605;&#x2605;&#x2605;&#x2605;&#x2605;</span></div>`
        }
      }
      elm.innerHTML = nDiv 
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function getBoardGameName(data) {
      var objectid = data['@attributes']['objectid'];
      return boardgameBasicData[objectid]['name'];
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function getBoardGameRatingAverage(data) {
      var objectid = data['@attributes']['objectid'];
      return boardgameBasicData[objectid]['rating'];
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function getBoardGameDesigner(data) {
      if ($.isArray(data.boardgamedesigner)) {
        var boardgamedesigner = '';
        $.each(data.boardgamedesigner, function (index, value) {
          boardgamedesigner += (boardgamedesigner != '') ? ' & ' + value : value;
        });
        return boardgamedesigner;
      } else {
        return data.boardgamedesigner;
      }
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function getBoardGamePublisher(data) {
      if ($.isArray(data.boardgamepublisher)) {
        return data.boardgamepublisher[0];
      } else {
        return data.boardgamepublisher;
      }
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function addSliderSlide(data) {
      var boardGameName = getBoardGameName(data);
      var objectid = data['@attributes']['objectid'];
      $('.image_slider').append(`<div class="slider_item"><div class="image-outer"><a href="javascript:;" class="games-slider-item" data-objectid="${objectid}"><img src="${data.image}" class="img-fluid" id="sliderImg" data-BoardgamesId="${objectid}"></a></div><a href="javascript:;" data-objectid="${objectid}" data-BoardgamesId="${objectid}" class="text-uppercase font-DINCondensed text-truncate m-0 p-2 text-center overflow-hidden text-nowrap slide_item_title games-slider-item">${boardGameName}</a></div>`);
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function initiateSlickSlider() {
      $('.image_slider').slick({
        infinite: true,
        slidesToShow: 5,
        slidesToScroll: 3,
        dots: false,
        arrows: true,
        infinite: 0,
        autoplay: true,
        autoplaySpeed: 1000,
        responsive: [
          {
            breakpoint: 1024,
            settings: {
              slidesToShow: 3,
              slidesToScroll: 3,
              infinite: true,
              dots: false
            }
          },
          {
            breakpoint: 600,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 2
            }
          },
          {
            breakpoint: 480,
            settings: {
              slidesToShow: 1,
              slidesToScroll: 1
            }
          }
          // You can unslick at a given breakpoint now by adding:
          // settings: "unslick"
          // instead of a settings object
        ]
      });
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function initiateSlideShowSlider() {
      //console.log("Start slick anim")
      $('.slideshow-slider').slick({
          infinite: true,
          slidesToShow: 1,
          slidesToScroll: 1,
          autoplay: true,
          autoplaySpeed: 5000,
          responsive: [
          {
            breakpoint: 1024,
            settings: {
              slidesToShow: 1,
              slidesToScroll: 1,
              infinite: true,
              dots: false
            }
          },
          {
            breakpoint: 600,
            settings: {
              slidesToShow: 1,
              slidesToScroll: 1
            }
          },
          {
            breakpoint: 480,
            settings: {
              slidesToShow: 1,
              slidesToScroll: 1
            }
          }
        ]
      });
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function initiateRelatedGamesSlider() {
      if ($('.related_games').find('div').length) {
        $('.related_games').slick({
          infinite: true,
          slidesToShow: 5,
          slidesToScroll: 2,
          autoplay: true,
          responsive: [
          {
            breakpoint: 1024,
            settings: {
              slidesToShow: 3,
              slidesToScroll: 1,
              infinite: true,
              dots: false
            }
          },
          {
            breakpoint: 600,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 1
            }
          },
          {
            breakpoint: 480,
            settings: {
              slidesToShow: 1,
              slidesToScroll: 1
            }
          }
        ]
        });
      }
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    jQuery(document).ready(function ($) {
      /*$(document).on('click', ".games-slider-item", function () {
        var objectId = $(this).data("objectid");
        scrollPage("#list-game-" + objectId);
      });*/
      //////////////////////////////////////////////////////////////////////////////////////////////////
      $(document).on('click', ".page-number", function () {
        if($(this).hasClass('active') === false){
          // console.log("no Active Class!")
          paged = $(this).data('paged');
          resetListPageContent(paged);
        }
      });
      //////////////////////////////////////////////////////////////////////////////////////////////////
      $(document).on('click', ".page-pre", function () {
        if($(this).hasClass("disabled-link")){
          return;
        }
        paged = parseInt(paged) - 1;
        resetListPageContent(paged);
      });
      //////////////////////////////////////////////////////////////////////////////////////////////////
      $(document).on('click', ".page-next", function () {
        if($(this).hasClass("disabled-link")){
          return;
        }
        paged = parseInt(paged) + 1;
        resetListPageContent(paged);
      });
      //////////////////////////////////////////////////////////////////////////////////////////////////
      $(document).on('click', ".back-btn", function () {
        if(sourceType != ''){
            if(sourceType == 'slideshow'){
              displaySliderShowSection();
              hideListViewSection();
              hideDetailsViewSection();
            } else {
                if (paged) {
                  resetListPageContent(paged);
                }
                displayListViewSection();
                hideDetailsViewSection();
            }
        } else {
           if (paged) {
              resetListPageContent(paged);
            }
            displayListViewSection();
            hideDetailsViewSection();   
        }
      });
      //////////////////////////////////////////////////////////////////////////////////////////////////
      $(document).on('click', ".view-details", function () {
        var objectid = $(this).data('objectid');
        sourceType = $(this).attr("data-sourceType");
        $.each(boardgames, function (index, data) {
          var data_objectid = data['@attributes']['objectid'];
          if (objectid == data_objectid) {
            renderDetailsViewHTML(data);
            return;
          }
        });
      });
    });
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function scrollPage(element) {
      $('html, body').animate({
        scrollTop: $(element).offset().top
      });
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function renderDetailsViewHTML(data) {
      hideListViewSection();
      hideSliderShowSection();
      displayDetailsViewSection();
      var objectid = data['@attributes']['objectid'];
      var boardGameName = getBoardGameName(data);
      var boardGameDesigner = getBoardGameDesigner(data);
      var gameRatingAverage = getBoardGameRatingAverage(data);
      //var ratingInPercentage = ((gameRatingAverage*100)/5);

      ////////////////////////////////////////////////////////////////////////////////////

      //var ratingInPercentage = ((gameRatingAverage - 6)*5/2) * 20;
      var ratingInPercentage = ((gameRatingAverage - 5)*5/2) * 14;

      if(ratingInPercentage < 0) {
        ratingInPercentage = 0
      } else if(ratingInPercentage > 100) {
        ratingInPercentage = 100
      }

      ////////////////////////////////////////////////////////////////////////////////////



      var playerStats = (data.minplayers == data.maxplayers) ? data.maxplayers : data.minplayers+"-"   +data.maxplayers;
      var playtimeStats = (data.minplaytime == data.maxplaytime) ? data.maxplaytime : data.minplaytime+"-"+data.maxplaytime;

      $('.game-details').html(`       
            <div class="bg-light border-0 card game-card">
              <div class="card-body">
                <div class="row">
                  <div class="col-lg-9 col-md-8">
                    <h3 class="font-DINCondensed game-title text-primary">${boardGameName} <sup class="sup-small" data-objectid="${data.objectid}">${data.yearpublished}</sup></h3>
                    <h5 class="font-DINCondensed game-designer">${boardGameDesigner}</h5>

                    <div class="row mt-3">
                      <div class="col-md-4">
                        <div class="img-box"><img src="${data.image}" class="img-fluid"></div>
                        <div class="gamePrivateDataHTML details-game-${objectid}-private-data"></div>
                      </div>
                      <div class="col-md-8">
                        <div class="font-DINCondensed text-large">${data.description}</div>                        
                      </div>                    
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-4 text-md-right">
                    <div class="metaGroup"><span><img src="./images/earshot-games_player.png" width="35px">${playerStats}</span><span><img src="./images/earshot-games_time.png"  width="35px">${playtimeStats}</span><span><img src="./images/earshot-games_age.png"  width="35px">${data.age}+</span></div>
                    <!--div class="ratingWrapper"-->
                    <div id="${objectid}_d" class="ratingWrapper" onClick='toggleRating(event, ${ratingInPercentage}, ${gameRatingAverage})'>
                      <div id="star_d" class="ratingStar" style="width: ${ratingInPercentage}%"> 
                        <span>&#x2605;&#x2605;&#x2605;&#x2605;&#x2605;</span>
                      </div> 
                    </div>
                    <!--<div data-level="50" class="game-level text-large bg-primary text-center text-uppercase my-2">
                      <span>Medium</span>
                    </div>-->
                    <div class="card text-left my-4">
                      <div class="card-header bg-alto py-1 px-2">MECHANICS</div>
                      <div class="card-body p-2"><div class="boardgamemechanic"> </div></div>
                    </div>
                    <div class="barcode">	
                      <div class="qrcode" id ="${objectid}_barcode"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <h5 class="related_title">You might also like</h5>  
            <div class="related_games"></div>
           `);

      renderGamePrivateData(data, `.details-game-${objectid}-private-data`);
      boardgameMechanicData(data);
      renderRealetedBoardGameSlider();
      renderQRCode(`${objectid}_barcode`, objectid);
      scrollPage(".detail-view-section");
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function boardgameMechanicData(data) {
      var boardgameMechanic = '';
      if ($.isArray(data.boardgamemechanic)) {
        $.each(data.boardgamemechanic, function (gameMechanic, index) {
          boardgameMechanic += '<div>' + index + '</div>';
        });
      } else if(data.boardgamemechanic){
        boardgameMechanic = data.boardgamemechanic;
      }
      boardgameMechanic = (boardgameMechanic == '') ? 'No Mechanics' : boardgameMechanic;
      $('.boardgamemechanic').append(boardgameMechanic);
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function hideListViewSection() {
      $('.list-view-section').addClass('d-none');
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function displayListViewSection() {
      $('.list-view-section').removeClass('d-none');
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function hideDetailsViewSection() {
      $('.detail-view-section').addClass('d-none');
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function displayDetailsViewSection() {
      $('.detail-view-section').removeClass('d-none');
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function hideSliderShowSection() {
      $('.list-slideshow-section').addClass('d-none');
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function displaySliderShowSection() {
      $('.list-slideshow-section').removeClass('d-none');
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function renderGamePrivateData(data, elementClass) {
      var objectid = data['@attributes']['objectid'];
      var gamePrivatedataHTML = '';
      $(document).find(elementClass).html(gamePrivatedataHTML).addClass('d-none');
      $.each(privateDataList, function (index, row) {
        if (row["Game ID"] == objectid) {
          $.each(row, function (key, value) {
            if (key != "Game ID" && key != "Game Name" && key != "Showcase" && key != "") {
              if(value != "") {
                gamePrivatedataHTML += "<div class=''><strong>" + key + ": </strong> <span class=''>" + value + "</span></div>";
              }
            }
          });
          return;
        }
      });
      // console.log("gamePrivatedataHTML ", gamePrivatedataHTML);
      if(gamePrivatedataHTML != ''){
        $(document).find(elementClass).html(gamePrivatedataHTML).removeClass('d-none');
      }
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function shuffleArray(array) {
      let currentIndex = array.length,  randomIndex;
      // While there remain elements to shuffle.
      while (currentIndex != 0) {
        // Pick a remaining element.
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        // And swap it with the current element.
        [array[currentIndex], array[randomIndex]] = [
          array[randomIndex], array[currentIndex]];
      }
      return array;
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function resetListPageContent(page) {
      //console.log("Global Paged ", page);  
      //console.log(boardgames.length, " --- ", page)

      let nextIndex = (page * 10);
      $(".cardList").html('');
      $('.image_slider').slick('unslick'); /* ONLY remove the classes and handlers added on initialize */
      $('.image_slider').html('');
      for (var loop = 0; loop < 10; loop++) {
        if (boardgames[nextIndex]) {
          renderListViewItem(boardgames[nextIndex]);
          nextIndex += 1;
        }
      }
      initiateSlickSlider();
      renderPaginationHTML();
    }
    //////////////////////////////////////////////////////////////////////////////////////////////////
    function renderQRCode(element, gameID){
      const qrcode = new QRCode(element, {
        //text: 'https://boardgamegeek.com/',
        text: 'https://boardgamegeek.com/boardgame/' + gameID,
        width: 120,
        height: 120,
        colorDark : '#000',
        colorLight : '#fff',
        correctLevel : QRCode.CorrectLevel.H
      });	
    }

  </script>
</body>
</html>